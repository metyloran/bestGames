<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Boards â€” plain HTML/CSS/JS</title>
  <style>
    :root{--bg:#f7fafc;--muted:#6b7280;--accent:#0ea5a4}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Helvetica,Arial}
    .app{display:flex;height:100vh;background:var(--bg)}
    aside{width:280px;background:#fff;border-right:1px solid #e6edf3;padding:12px;box-sizing:border-box;display:flex;flex-direction:column}
    header h2{margin:0;font-size:16px}
    .boards-list{flex:1;overflow:auto;margin-top:8px}
    .board-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:6px;cursor:pointer}
    .board-item.active{background:#f1f5f9}
    .controls{display:flex;gap:8px;margin-top:8px}
    .controls button{flex:1;padding:8px;border-radius:6px;border:1px solid #e6edf3;background:#fff;cursor:pointer}

    main{flex:1;display:flex;flex-direction:column}
    .topbar{height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;background:#fff;border-bottom:1px solid #e6edf3}
    .topbar .left{display:flex;gap:12px;align-items:center}
    .topbar .right{display:flex;gap:8px;align-items:center}
    .canvas-wrap{position:relative;flex:1;overflow:hidden;background:linear-gradient(90deg,#fbfdff,#fff)}

    /* grid background */
    .board-canvas{position:absolute;left:0;top:0;width:100%;height:100%;touch-action:none}
    .stage{position:absolute;left:0;top:0;transform-origin:0 0}

    /* item styles */
    .item{position:absolute;box-sizing:border-box;user-select:none}
    .item .content{width:100%;height:100%;padding:8px;box-sizing:border-box;border-radius:6px;overflow:hidden}
    .note .content{white-space:pre-wrap}
    .item.selected{outline:2px solid rgba(14,165,164,0.25);box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    .resize-handle{position:absolute;width:12px;height:12px;right:-6px;bottom:-6px;cursor:nwse-resize;border-radius:2px}

    /* inspector */
    .inspector{position:absolute;right:16px;bottom:16px;width:280px;background:#fff;padding:12px;border-radius:8px;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
    .inspector textarea{width:100%;box-sizing:border-box;padding:8px;height:120px}

    .footer-hint{font-size:12px;color:var(--muted);padding:8px}

    input[type=file]{display:block}
  </style>
</head>
<body>
<div class="app">
  <aside>
    <header>
      <h2>Boards</h2>
      <div style="font-size:12px;color:var(--muted)">Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ â€¢ share via URL</div>
    </header>

    <div class="controls">
      <button id="btnNew">New</button>
      <button id="btnShare">Share</button>
    </div>

    <div class="boards-list" id="boardsList"></div>

    <div style="border-top:1px solid #eef2f7;padding-top:10px;margin-top:8px">
      <div style="display:flex;gap:6px;margin-bottom:6px">
        <button id="addNote">+ Note</button>
        <button id="addRect">â–­</button>
        <button id="addEllipse">â—¯</button>
      </div>
      <label>Upload image</label>
      <input id="imgUpload" type="file" accept="image/*" />
      <div style="display:flex;gap:6px;margin-top:8px">
        <button id="exportBtn">Export</button>
        <label style="flex:1;text-align:center;border:1px solid #e6edf3;padding:6px;border-radius:6px;cursor:pointer">Import
          <input id="importFile" type="file" accept="application/json" style="display:none" />
        </label>
      </div>
      <div class="footer-hint">Hints: drag items, Shift to pan, Delete to remove, Ctrl/Cmd+D duplicate</div>
    </div>
  </aside>

  <main>
    <div class="topbar">
      <div class="left">
        <div id="boardTitle" style="font-weight:600"></div>
        <div style="font-size:13px;color:var(--muted)">Items: <span id="itemCount">0</span></div>
      </div>
      <div class="right">
        <button id="zoomOut">-</button>
        <div id="zoomLabel">100%</div>
        <button id="zoomIn">+</button>
        <button id="resetView">Reset</button>
        <button id="copyLink">Copy share link</button>
      </div>
    </div>

    <div class="canvas-wrap" id="canvasWrap">
      <div id="boardCanvas" class="board-canvas"></div>
      <div class="inspector" id="inspector">
        <div style="font-weight:600;margin-bottom:6px">Inspector</div>
        <div id="inspectorBody">Select an item to edit</div>
      </div>
    </div>
  </main>
</div>

<script>
// Simple Interactive Boards â€” plain JS single file
// Features: multiple boards stored in localStorage, items (note/shape/image), drag/resize, pan/zoom, share state via URL, export/import JSON

const LS_KEY = 'ib_boards_v1';
const boardsListEl = document.getElementById('boardsList');
const boardCanvas = document.getElementById('boardCanvas');
const boardTitle = document.getElementById('boardTitle');
const itemCountEl = document.getElementById('itemCount');
const inspector = document.getElementById('inspector');
const inspectorBody = document.getElementById('inspectorBody');
const zoomLabel = document.getElementById('zoomLabel');

let boards = loadBoards();
let activeBoardId = null;
let zoom = 1;
let offset = {x:0,y:0};
let dragging = null;
let resizing = null;
let panning = false;
let panStart = null;
let selectedId = null;

function uid(n=8){return Math.random().toString(36).slice(2,2+n)}
function encodeState(obj){return btoa(unescape(encodeURIComponent(JSON.stringify(obj))));}
function decodeState(s){try{return JSON.parse(decodeURIComponent(escape(atob(s))));}catch(e){return null}}

function loadBoards(){
  try{const raw=localStorage.getItem(LS_KEY); if(raw) return JSON.parse(raw);}catch(e){}
  const b = [makeBoard('My first board')]; localStorage.setItem(LS_KEY, JSON.stringify(b)); return b;
}
function saveBoards(){localStorage.setItem(LS_KEY, JSON.stringify(boards));}
function makeBoard(name='Untitled'){return {id:uid(),name,items:[],createdAt:Date.now()}} 

// init: check URL for shared board
(function initFromURL(){const url=new URL(location.href);const shared=url.searchParams.get('b');if(shared){const decoded=decodeState(shared);if(decoded && decoded.id){const exists=boards.some(x=>x.id===decoded.id);if(!exists){boards.push(decoded);saveBoards();} activeBoardId=decoded.id;}} if(!activeBoardId){activeBoardId = boards[0].id;} renderBoards(); renderActiveBoard();})();

function renderBoards(){boardsListEl.innerHTML=''; boards.forEach(b=>{
  const el=document.createElement('div'); el.className='board-item'+(b.id===activeBoardId? ' active':'');
  el.innerHTML = `<div style="flex:1"><div style='font-weight:600'>${escapeHtml(b.name)}</div><div style='font-size:12px;color:${varColor('--muted') }'>${b.items.length} items</div></div>`;
  el.onclick=()=>{activeBoardId=b.id; renderBoards(); renderActiveBoard();};
  const btns=document.createElement('div');btns.style.marginLeft='8px';
  const rename=document.createElement('button'); rename.textContent='âœï¸'; rename.onclick=(e)=>{e.stopPropagation();const nv=prompt('Rename',b.name); if(nv) {b.name=nv; saveBoards(); renderBoards(); renderActiveBoard();}};
  const del=document.createElement('button'); del.textContent='ðŸ—‘ï¸'; del.onclick=(e)=>{e.stopPropagation(); if(!confirm('Delete board?')) return; boards=boards.filter(x=>x.id!==b.id); if(boards.length===0){const nb=makeBoard('Board 1'); boards.push(nb); activeBoardId=nb.id;} else if(activeBoardId===b.id){activeBoardId=boards[0].id;} saveBoards(); renderBoards(); renderActiveBoard();};
  btns.appendChild(rename); btns.appendChild(del); el.appendChild(btns);
  boardsListEl.appendChild(el);
})}

function renderActiveBoard(){const board = boards.find(b=>b.id===activeBoardId); if(!board) return; boardTitle.textContent = board.name; itemCountEl.textContent = board.items.length; renderCanvas(board);}

function renderCanvas(board){ // render items
  boardCanvas.innerHTML = ''; boardCanvas.style.transform = `translate(${offset.x}px, ${offset.y}px)`;
  const stage = document.createElement('div'); stage.className='stage'; stage.style.transform = `scale(${zoom})`; stage.style.width = '4000px'; stage.style.height='3000px';
  board.items.forEach(it=>{
    const el = document.createElement('div'); el.className='item '+(it.type||''); el.style.left = it.x + 'px'; el.style.top = it.y + 'px'; el.style.width = it.w + 'px'; el.style.height = it.h + 'px'; el.dataset.id = it.id;
    if(it.type==='note'){
      const c = document.createElement('div'); c.className='content'; c.contentEditable=true; c.innerText = it.text||''; c.style.background = it.color||'#fff9b1'; c.onblur = ()=>{it.text = c.innerText; saveBoards();}; el.appendChild(c);
    } else if(it.type==='shape'){
      const c = document.createElement('div'); c.className='content'; c.style.background = it.shape==='ellipse' ? 'transparent' : (it.color||'#d1e8ff'); c.style.borderRadius = it.shape==='ellipse'? '50%':'6px'; el.appendChild(c);
    } else if(it.type==='image'){
      const img = document.createElement('img'); img.src = it.src; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover'; img.style.borderRadius='6px'; el.appendChild(img);
    }
    // selection
    if(selectedId===it.id) el.classList.add('selected');
    // handlers
    el.addEventListener('pointerdown', e=>{ onItemPointerDown(e, it); });
    const rh = document.createElement('div'); rh.className='resize-handle'; rh.addEventListener('pointerdown', e=>{ onResizeStart(e,it); });
    el.appendChild(rh);
    stage.appendChild(el);
  });
  boardCanvas.appendChild(stage);
  updateInspector();
}

// helper to get active board and item
function getActiveBoard(){return boards.find(b=>b.id===activeBoardId);} 
function getItemById(id){const b=getActiveBoard(); return b.items.find(x=>x.id===id);} 

// add items
function addNote(){ const b=getActiveBoard(); const it={id:uid(),type:'note',x:100,y:100,w:220,h:140,text:'New note',color:'#fff9b1'}; b.items.push(it); saveBoards(); renderActiveBoard(); selectedId=it.id; }
function addShape(shape){ const b=getActiveBoard(); const it={id:uid(),type:'shape',shape,x:150,y:150,w:140,h:100,color:'#d1e8ff'}; b.items.push(it); saveBoards(); renderActiveBoard(); selectedId=it.id; }
function addImageFromFile(file){ const reader=new FileReader(); reader.onload=(e)=>{ const b=getActiveBoard(); const it={id:uid(),type:'image',x:80,y:80,w:300,h:200,src:e.target.result}; b.items.push(it); saveBoards(); renderActiveBoard(); selectedId=it.id; }; reader.readAsDataURL(file); }

// drag
function onItemPointerDown(e,it){ e.stopPropagation(); const el = e.currentTarget; const startX = e.clientX; const startY = e.clientY; const init = {x:it.x,y:it.y}; selectedId = it.id; renderActiveBoard();
  function onMove(ev){ const dx = (ev.clientX - startX) / zoom; const dy = (ev.clientY - startY) / zoom; it.x = init.x + dx; it.y = init.y + dy; renderActiveBoard(); }
  function onUp(){ window.removeEventListener('pointermove', onMove); window.removeEventListener('pointerup', onUp); saveBoards(); }
  window.addEventListener('pointermove', onMove); window.addEventListener('pointerup', onUp);
}

// resize
function onResizeStart(e,it){ e.stopPropagation(); const startX = e.clientX; const startY = e.clientY; const init = {x:it.x,y:it.y,w:it.w,h:it.h};
  function onMove(ev){ const dx = (ev.clientX - startX) / zoom; const dy = (ev.clientY - startY) / zoom; it.w = Math.max(24, init.w + dx); it.h = Math.max(24, init.h + dy); renderActiveBoard(); }
  function onUp(){ window.removeEventListener('pointermove', onMove); window.removeEventListener('pointerup', onUp); saveBoards(); }
  window.addEventListener('pointermove', onMove); window.addEventListener('pointerup', onUp);
}

// canvas panning
const canvasWrap = document.getElementById('canvasWrap');
canvasWrap.addEventListener('pointerdown', e=>{
  if(e.shiftKey || e.button===1){ panning=true; panStart={x:e.clientX,y:e.clientY,ox:offset.x,oy:offset.y}; }
  else { // deselect
    selectedId = null; renderActiveBoard(); }
});
canvasWrap.addEventListener('pointermove', e=>{ if(panning){ const dx = e.clientX - panStart.x; const dy = e.clientY - panStart.y; offset.x = panStart.ox + dx; offset.y = panStart.oy + dy; renderActiveBoard(); }});
canvasWrap.addEventListener('pointerup', e=>{ panning=false; saveBoards(); });

// zoom
function setZoom(z){ zoom = Math.max(0.2, Math.min(3, z)); zoomLabel.textContent = Math.round(zoom*100)+'%'; renderActiveBoard(); }

// inspector
function updateInspector(){ const it = selectedId ? getItemById(selectedId) : null; if(!it){ inspectorBody.innerHTML='Select an item to edit'; return;} let html = `<div style="font-size:13px;font-weight:600;margin-bottom:6px">Type: ${it.type}</div>`;
  if(it.type==='note'){ html += `<textarea id='insText'>${escapeHtml(it.text||'')}</textarea><div style='margin-top:6px'><label>Color</label> <input id='insColor' type='color' value='${it.color||'#fff9b1'}' /></div>`; }
  if(it.type==='image'){ html += `<div>Image â€” ${Math.round(it.w)}Ã—${Math.round(it.h)}</div>`; }
  html += `<div style='display:flex;gap:6px;margin-top:8px'><button id='copyJson'>Copy JSON</button><button id='delItem' style='color:#b91c1c'>Delete</button></div>`;
  inspectorBody.innerHTML = html;
  const t = document.getElementById('insText'); if(t){ t.addEventListener('input', ()=>{ it.text = t.value; saveBoards(); renderActiveBoard(); }); }
  const col = document.getElementById('insColor'); if(col){ col.addEventListener('input', ()=>{ it.color = col.value; saveBoards(); renderActiveBoard(); }); }
  document.getElementById('copyJson').onclick = ()=>{ navigator.clipboard.writeText(JSON.stringify(it)); alert('Item JSON copied'); };
  document.getElementById('delItem').onclick = ()=>{ const b = getActiveBoard(); b.items = b.items.filter(x=>x.id!==it.id); selectedId = null; saveBoards(); renderActiveBoard(); };
}

// utilities
function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }
function varColor(name){ return getComputedStyle(document.documentElement).getPropertyValue(name) || '#6b7280'; }

// keyboard shortcuts
window.addEventListener('keydown',(e)=>{ if(e.key==='Delete'){ if(selectedId){ const b=getActiveBoard(); b.items=b.items.filter(x=>x.id!==selectedId); selectedId=null; saveBoards(); renderActiveBoard(); }} if((e.ctrlKey||e.metaKey)&& e.key.toLowerCase()==='d'){ if(selectedId){ const b=getActiveBoard(); const it = getItemById(selectedId); if(it){ const copy = JSON.parse(JSON.stringify(it)); copy.id=uid(); copy.x += 20; copy.y += 20; b.items.push(copy); saveBoards(); renderActiveBoard(); } } } });

// share link
function makeShareLink(){ const b = getActiveBoard(); const base = new URL(location.href); base.searchParams.set('b', encodeState(b)); return base.toString(); }

// export/import
function exportBoard(){ const b = getActiveBoard(); const data = JSON.stringify(b, null, 2); const blob = new Blob([data], {type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = (b.name||'board') + '.json'; a.click(); URL.revokeObjectURL(a.href); }
function importBoardFromFile(file){ const reader = new FileReader(); reader.onload = (e)=>{ try{ const parsed = JSON.parse(e.target.result); if(!parsed.id) parsed.id = uid(); boards.push(parsed); saveBoards(); activeBoardId = parsed.id; renderBoards(); renderActiveBoard(); }catch(err){alert('Invalid JSON file')} }; reader.readAsText(file); }

// attach UI events
document.getElementById('btnNew').onclick = ()=>{ const nb = makeBoard('Board ' + (boards.length+1)); boards.push(nb); saveBoards(); activeBoardId = nb.id; renderBoards(); renderActiveBoard(); };
document.getElementById('btnShare').onclick = ()=>{ const url = makeShareLink(); navigator.clipboard.writeText(url); alert('Share link copied'); };
document.getElementById('addNote').onclick = addNote;
document.getElementById('addRect').onclick = ()=>addShape('rect');
document.getElementById('addEllipse').onclick = ()=>addShape('ellipse');
imgUpload.onchange = (e)=>{ if(e.target.files && e.target.files[0]) addImageFromFile(e.target.files[0]); };
document.getElementById('exportBtn').onclick = exportBoard;
document.getElementById('importFile').onchange = (e)=>{ if(e.target.files && e.target.files[0]) importBoardFromFile(e.target.files[0]); };
document.getElementById('zoomIn').onclick = ()=>setZoom(+(zoom+0.1).toFixed(2));
document.getElementById('zoomOut').onclick = ()=>setZoom(+(zoom-0.1).toFixed(2));
document.getElementById('resetView').onclick = ()=>{ zoom=1; offset={x:0,y:0}; renderActiveBoard(); };
document.getElementById('copyLink').onclick = ()=>{ navigator.clipboard.writeText(makeShareLink()); alert('Share link copied'); };

overridePointerCapture();

// helper to ensure pointerup events always clear panning
function overridePointerCapture(){ window.addEventListener('pointerup', ()=>{ panning=false; }); }

// done
</script>
</body>
</html>
